<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#09090b">
<title>Clip Extractor</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;500;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#09090b;--s1:#141416;--s2:#1c1c1f;--br:#2a2a2e;--t1:#e8e8ea;--t2:#71717a;--ac:#a3e635;--ac2:#22d3ee;--rd:14px}
body{font-family:'Outfit',system-ui,sans-serif;background:var(--bg);color:var(--t1);min-height:100dvh;-webkit-font-smoothing:antialiased}
.c{max-width:460px;margin:0 auto;padding:16px 14px 80px}

.hd{text-align:center;padding:16px 0 24px}
.hd h1{font-family:'Space Mono',monospace;font-size:24px;font-weight:700;letter-spacing:-1px;background:linear-gradient(135deg,var(--ac),var(--ac2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hd p{font-size:12px;color:var(--t2);margin-top:4px}
.badge{display:inline-block;background:var(--s2);border:1px solid var(--br);padding:2px 8px;border-radius:20px;font-size:9px;font-family:'Space Mono',monospace;color:var(--ac);margin-top:8px;letter-spacing:1px;text-transform:uppercase}

.upload{background:var(--s1);border:2px dashed var(--br);border-radius:var(--rd);padding:32px 20px;text-align:center;cursor:pointer;transition:all .2s}
.upload:active{transform:scale(.98)}
.upload.has{border:2px solid var(--ac);padding:14px 16px}
.upload .icon{font-size:40px;margin-bottom:6px}
.upload .main{font-size:15px;font-weight:600}
.upload .sub{font-size:11px;color:var(--t2);margin-top:3px}
.file-row{display:flex;align-items:center;gap:8px;text-align:left}
.file-row .info{flex:1;min-width:0}
.file-row .name{font-size:13px;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.file-row .meta{font-size:10px;color:var(--t2)}
input[type=file]{display:none}

.btn{width:100%;padding:14px;border:none;border-radius:12px;font-family:'Outfit',sans-serif;font-size:14px;font-weight:700;cursor:pointer;display:block;text-align:center;transition:all .15s;letter-spacing:.5px}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.35;cursor:default;transform:none}
.btn-go{background:var(--ac);color:#000;margin-top:14px}
.btn-dl{background:linear-gradient(135deg,var(--ac),var(--ac2));color:#000;margin-top:10px}
.btn-new{background:var(--s2);color:var(--t1);border:1px solid var(--br);margin-top:8px}

.prog{margin-top:14px;display:none}
.prog.on{display:block}
.prog-bg{height:4px;background:var(--s2);border-radius:2px;overflow:hidden}
.prog-bar{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--ac),var(--ac2));width:0%;transition:width .4s}
.prog-txt{font-size:11px;color:var(--t2);text-align:center;margin-top:6px;font-family:'Space Mono',monospace}

.msg{text-align:center;padding:10px;border-radius:8px;font-size:12px;margin-top:10px;display:none}
.msg.on{display:block}
.msg.err{background:rgba(239,68,68,.1);color:#ef4444}
.msg.ok{background:rgba(163,230,53,.08);color:var(--ac)}

.result{background:var(--s1);border:1px solid var(--br);border-radius:var(--rd);padding:14px;margin-top:16px;display:none}
.result.on{display:block;animation:slideUp .4s ease}
.result h3{font-size:12px;font-weight:700;color:var(--ac);font-family:'Space Mono',monospace;margin-bottom:12px}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:12px}
.stat{background:var(--s2);padding:8px 10px;border-radius:8px}
.stat-l{font-size:9px;color:var(--t2);text-transform:uppercase;letter-spacing:1px;font-family:'Space Mono',monospace}
.stat-v{font-size:16px;font-weight:700;margin-top:1px}
.vid-box{border-radius:8px;overflow:hidden;background:#000;margin-bottom:10px}
.vid-box video{width:100%;display:block}

.info-cards{margin-top:28px;display:grid;gap:8px}
.info-card{background:var(--s1);border:1px solid var(--br);border-radius:10px;padding:12px}
.info-card b{font-size:11px}
.info-card p{font-size:10px;color:var(--t2);line-height:1.5;margin-top:3px}

@keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.pulsing{animation:pulse 1.5s infinite}
</style>
</head>
<body>
<div class="c">
  <div class="hd">
    <h1>‚úÇ CLIP EXTRACTOR</h1>
    <p>Extrae el clip original de videos dise√±ados</p>
    <span class="badge">v3.0 ¬∑ Claude Vision ¬∑ any design</span>
  </div>

  <div class="upload" id="drop" onclick="$fi.click()">
    <div id="uploadUI">
      <div class="icon">üé¨</div>
      <div class="main">Seleccionar video</div>
      <div class="sub">MP4 ¬∑ MOV ¬∑ hasta 500MB</div>
    </div>
  </div>
  <input type="file" id="fi" accept="video/*">

  <div class="prog" id="prog">
    <div class="prog-bg"><div class="prog-bar" id="bar"></div></div>
    <div class="prog-txt pulsing" id="ptxt">Subiendo...</div>
  </div>

  <div class="msg" id="msg"></div>

  <button class="btn btn-go" id="btnGo" style="display:none" onclick="process()">üîç DETECTAR Y EXTRAER</button>

  <div class="result" id="result">
    <h3>// RESULTADO</h3>
    <div class="stats">
      <div class="stat"><div class="stat-l">Original</div><div class="stat-v" id="sOrig">‚Äî</div></div>
      <div class="stat"><div class="stat-l">Clip</div><div class="stat-v" id="sClip">‚Äî</div></div>
      <div class="stat"><div class="stat-l">Reducci√≥n</div><div class="stat-v" id="sRed">‚Äî</div></div>
      <div class="stat"><div class="stat-l">Recortado</div><div class="stat-v" id="sCrop">‚Äî</div></div>
      <div class="stat" style="grid-column:1/-1"><div class="stat-l">Detecci√≥n</div><div class="stat-v" id="sMethod" style="font-size:12px">‚Äî</div></div>
    </div>
    <div class="vid-box"><video id="resVid" controls playsinline></video></div>
    <a class="btn btn-dl" id="btnDl" href="#" download>‚¨á DESCARGAR CLIP</a>
    <button class="btn btn-new" onclick="reset()">‚Ü∫ NUEVO VIDEO</button>
  </div>

  <div class="info-cards">
    <div class="info-card">
      <b>üéØ Claude Vision</b>
      <p>Detecci√≥n con IA visual: analiza el dise√±o completo, detecta los 4 bordes exactos del clip y se adapta a cualquier layout sin importar colores ni estructura.</p>
    </div>
    <div class="info-card">
      <b>‚ö° Procesamiento en servidor</b>
      <p>FFmpeg recorta tu video en segundos. Archivos temporales se borran autom√°ticamente.</p>
    </div>
  </div>
</div>

<script>
const $fi=document.getElementById('fi'),$drop=document.getElementById('drop'),
  $prog=document.getElementById('prog'),$bar=document.getElementById('bar'),
  $ptxt=document.getElementById('ptxt'),$msg=document.getElementById('msg'),
  $btn=document.getElementById('btnGo'),$res=document.getElementById('result');

let file=null;

$fi.onchange=e=>{if(e.target.files[0])pick(e.target.files[0])};
$drop.ondragover=e=>{e.preventDefault();$drop.style.borderColor='var(--ac)'};
$drop.ondragleave=()=>$drop.style.borderColor='';
$drop.ondrop=e=>{e.preventDefault();$drop.style.borderColor='';if(e.dataTransfer.files[0])pick(e.dataTransfer.files[0])};

function pick(f){
  file=f;
  $drop.classList.add('has');
  const name=f.name.length>28?f.name.slice(0,25)+'...':f.name;
  $drop.querySelector('#uploadUI').innerHTML=`
    <div class="file-row">
      <span style="font-size:20px">‚úÖ</span>
      <div class="info">
        <div class="name">${name}</div>
        <div class="meta">${(f.size/1048576).toFixed(1)}MB</div>
      </div>
      <span style="font-size:10px;color:#52525b">Cambiar</span>
    </div>`;
  $btn.style.display='';
  $res.classList.remove('on');
  hideMsg();
}

function prog(pct,txt){
  $prog.classList.add('on');
  $bar.style.width=pct+'%';
  if(txt)$ptxt.textContent=txt;
}

function showMsg(t,type){$msg.textContent=t;$msg.className='msg on '+type}
function hideMsg(){$msg.className='msg'}

async function process(){
  if(!file)return;
  $btn.disabled=true;
  $btn.textContent='‚è≥ Procesando...';
  hideMsg();
  $res.classList.remove('on');

  const form=new FormData();
  form.append('video',file);

  try{
    // Upload with progress
    prog(0,'Subiendo video...');
    const xhr=new XMLHttpRequest();
    const uploadDone=new Promise((res,rej)=>{
      xhr.upload.onprogress=e=>{if(e.lengthComputable)prog(Math.round(e.loaded/e.total*50),'Subiendo... '+Math.round(e.loaded/e.total*100)+'%')};
      xhr.onload=()=>res(xhr);
      xhr.onerror=()=>rej(new Error('Error de red'));
    });
    xhr.open('POST','/api/process');
    xhr.send(form);

    prog(50,'Subido. Detectando clip...');

    const x=await uploadDone;
    prog(70,'Recortando...');

    if(x.status!==200){
      const err=JSON.parse(x.responseText);
      throw new Error(err.error||'Error del servidor');
    }

    const data=JSON.parse(x.responseText);
    prog(100,'¬°Listo!');

    // Show result
    const b=data.bounds, o=data.original, cl=data.clip;
    document.getElementById('sOrig').textContent=`${o.w}√ó${o.h}`;
    document.getElementById('sClip').textContent=`${cl.w}√ó${cl.h}`;
    document.getElementById('sRed').textContent=`${Math.round((1-cl.size/o.size)*100)}%`;
    document.getElementById('sCrop').textContent=`${Math.round((1-(cl.w*cl.h)/(o.w*o.h))*100)}% √°rea`;
    document.getElementById('sMethod').textContent=data.method==='claude-vision'?'Claude Vision ‚ú¶':'Algor√≠tmico';

    const dlUrl=data.download;
    document.getElementById('resVid').src=dlUrl;
    document.getElementById('btnDl').href=dlUrl;

    $res.classList.add('on');
    showMsg(`‚úÖ Clip: ${cl.w}√ó${cl.h}px extra√≠do en servidor`,'ok');

  }catch(e){
    showMsg(e.message,'err');
  }

  $btn.disabled=false;
  $btn.textContent='üîç DETECTAR Y EXTRAER';
  setTimeout(()=>$prog.classList.remove('on'),1500);
}

function reset(){
  file=null;
  $fi.value='';
  $drop.classList.remove('has');
  $drop.querySelector('#uploadUI').innerHTML=`
    <div class="icon">üé¨</div>
    <div class="main">Seleccionar video</div>
    <div class="sub">MP4 ¬∑ MOV ¬∑ hasta 500MB</div>`;
  $btn.style.display='none';
  $res.classList.remove('on');
  $prog.classList.remove('on');
  hideMsg();
}
</script>
</body>
</html>
